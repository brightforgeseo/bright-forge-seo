---
// PackagesSection.astro - Forged SEO Packages pricing section
// Prepare env-backed config values server-side and inline them into the client script.
const FALLBACK_PLAN_STARTER = 'P-3P2511639M442461SNCPPDNQ';
const FALLBACK_PLAN_GROWTH = 'P-0XV95953GX3131429NCPPFJA';
const FALLBACK_PLAN_FAST = 'P-95B79324H9815422TNCPPF4Y';

const ENV_PAYPAL_CLIENT_ID = import.meta.env.PUBLIC_PAYPAL_CLIENT_ID;
const ENV_PLAN_STARTER = import.meta.env.PUBLIC_PAYPAL_PLAN_ID_STARTER || FALLBACK_PLAN_STARTER;
const ENV_PLAN_GROWTH = import.meta.env.PUBLIC_PAYPAL_PLAN_ID_GROWTH || FALLBACK_PLAN_GROWTH;
const ENV_PLAN_FAST = import.meta.env.PUBLIC_PAYPAL_PLAN_ID_FAST || FALLBACK_PLAN_FAST;
const ENV_SUCCESS_URL = import.meta.env.PUBLIC_PAYPAL_SUCCESS_URL || '/thanks';
const ENV_CANCEL_URL = import.meta.env.PUBLIC_PAYPAL_CANCEL_URL || '/?payment=cancel';
const ENV_CURRENCY = import.meta.env.PUBLIC_PAYPAL_CURRENCY || 'PHP';
---

<section id="packages" class="py-24 bg-[#f8fafc] relative overflow-hidden">
  <!-- Background decoration -->
  <div class="absolute inset-0 opacity-5">
    <div class="absolute top-0 left-0 w-96 h-96 bg-[#f97316] rounded-full blur-3xl"></div>
    <div class="absolute bottom-0 right-0 w-96 h-96 bg-[#f97316] rounded-full blur-3xl"></div>
  </div>
  
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <!-- Header -->
    <div class="text-center max-w-4xl mx-auto mb-16">
      <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#f97316]/10 border border-[#f97316]/20 mb-6">
        <i class="fas fa-crown text-[#f97316]"></i>
        <span class="text-sm font-bold text-gray-800 uppercase tracking-wider">Premium SEO Packages</span>
      </div>
      <h2 class="text-4xl sm:text-5xl lg:text-6xl font-black text-gray-900 mb-6">
        Choose Your <span class="text-[#f97316]">Growth Velocity</span>
      </h2>
      <p class="text-lg sm:text-xl text-gray-700 leading-relaxed max-w-3xl mx-auto">
        Battle-tested SEO strategies tailored to your business goals. Every package includes full-service optimization—the only difference is speed of execution.
      </p>
    </div>

    <!-- Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 lg:gap-10">
      <!-- Starter Pace -->
      <div class="relative bg-[#f8fafc] rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden group">
        <!-- Top accent -->
        <div class="h-2 w-full bg-gray-500"></div>
        
        <div class="p-8">
          <!-- Plan badge -->
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-gray-100 text-gray-700 text-xs font-bold uppercase tracking-wide mb-4">
            <i class="fas fa-rocket text-gray-600"></i>
            Starter
          </div>
          
          <h3 class="text-2xl font-black text-gray-900 mb-2">Forged SEO Starter Pace</h3>
          
          <!-- Pricing -->
          <div class="flex items-baseline gap-2 mb-6">
            <span class="text-4xl font-black text-gray-900">₱26,400</span>
            <span class="text-gray-600">/month</span>
          </div>
          
          <!-- Hours badge -->
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-gradient-to-r from-gray-50 to-gray-100 border border-gray-200 mb-6">
            <i class="fas fa-clock text-gray-600"></i>
            <span class="text-sm font-semibold text-gray-700">16 hours/month • 4 hrs/week</span>
          </div>
          
          <!-- Features -->
          <div class="space-y-4 mb-8">
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Full-service SEO tailored to your goals</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Transparent tracking & management sheet</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed"><a href="/on-page-seo-services-philippines" class="text-[#f97316] font-semibold hover:underline">On-page</a> & <a href="/technical-seo-services-philippines" class="text-[#f97316] font-semibold hover:underline">Technical SEO</a></span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Content & <a href="/keyword-research-services" class="text-[#f97316] font-semibold hover:underline">keyword optimization</a></span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Google Business Profile optimization</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Steady progress on high-priority tasks</span>
            </div>
          </div>
          
          <!-- PayPal Button -->
          <div class="mt-auto">
            <div id="paypal-starter" class="paypal-button-container"></div>
            <p class="text-xs text-gray-500 text-center mt-3 flex items-center justify-center gap-1">
              <i class="fas fa-lock text-gray-400"></i>
              Secure checkout via PayPal
            </p>
          </div>
        </div>
      </div>

      <!-- Growth Pace - Most Popular -->
      <div class="relative bg-[#f8fafc] rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden group transform lg:scale-105">
        <!-- Popular badge -->
        <div class="absolute -top-1 -right-1 z-20">
          <div class="bg-[#f97316] text-white text-xs font-bold px-4 py-2 rounded-bl-2xl rounded-tr-2xl shadow-lg">
            MOST POPULAR
          </div>
        </div>
        
        <!-- Top accent -->
        <div class="h-2 w-full bg-[#f97316]"></div>
        
        <div class="p-8">
          <!-- Plan badge -->
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#f97316]/10 text-[#f97316] text-xs font-bold uppercase tracking-wide mb-4">
            <i class="fas fa-fire"></i>
            Growth
          </div>
          
          <h3 class="text-2xl font-black text-gray-900 mb-2">Forged SEO Growth Pace</h3>
          
          <!-- Pricing -->
          <div class="flex items-baseline gap-2 mb-6">
            <span class="text-4xl font-black text-[#f97316]">₱49,500</span>
            <span class="text-gray-600">/month</span>
          </div>
          
          <!-- Hours badge -->
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#f97316]/5 border border-[#f97316]/20 mb-6">
            <i class="fas fa-clock text-[#f97316]"></i>
            <span class="text-sm font-semibold text-gray-700">30 hours/month • 7.5 hrs/week</span>
          </div>
          
          <!-- Features -->
          <div class="space-y-4 mb-8">
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed font-semibold">Everything in Starter, plus:</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">2x faster optimization & content delivery</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Expanded keyword targeting & content</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Advanced <a href="/technical-seo-services-philippines" class="text-[#f97316] font-semibold hover:underline">technical SEO</a> & CRO</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Priority competitor analysis</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Faster turnaround on all tasks</span>
            </div>
          </div>
          
          <!-- PayPal Button -->
          <div class="mt-auto">
            <div id="paypal-growth" class="paypal-button-container"></div>
            <p class="text-xs text-gray-500 text-center mt-3 flex items-center justify-center gap-1">
              <i class="fas fa-lock text-gray-400"></i>
              Secure checkout via PayPal
            </p>
          </div>
        </div>
      </div>

      <!-- Fast Track -->
      <div class="relative bg-[#f8fafc] rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 overflow-hidden group">
        <!-- Top accent -->
        <div class="h-2 w-full bg-[#f97316]"></div>
        
        <div class="p-8">
          <!-- Plan badge -->
          <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#f97316]/10 text-[#f97316] text-xs font-bold uppercase tracking-wide mb-4">
            <i class="fas fa-bolt text-[#f97316]"></i>
            Fast Track
          </div>
          
          <h3 class="text-2xl font-black text-gray-900 mb-2">Forged SEO Fast Track</h3>
          
          <!-- Pricing -->
          <div class="flex items-baseline gap-2 mb-6">
            <span class="text-4xl font-black text-[#f97316]">₱82,500+</span>
            <span class="text-gray-600">/month</span>
          </div>
          
          <!-- Hours badge -->
          <div class="inline-flex items-center gap-2 px-4 py-2 rounded-lg bg-[#f97316]/5 border border-[#f97316]/20 mb-6">
            <i class="fas fa-clock text-[#f97316]"></i>
            <span class="text-sm font-semibold text-gray-700">50+ hours/month • 12.5+ hrs/week</span>
          </div>
          
          <!-- Features -->
          <div class="space-y-4 mb-8">
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed font-semibold">Everything in Growth, plus:</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Maximum speed & volume delivery</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Full <a href="/seo-audit-services" class="text-[#f97316] font-semibold hover:underline">site audit</a> in weeks</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Massive content & <a href="/backlink-seo-services-philippines" class="text-[#f97316] font-semibold hover:underline">backlink campaigns</a></span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Rapid testing & scaling strategies</span>
            </div>
            <div class="flex gap-3">
              <div class="flex-shrink-0 w-5 h-5 rounded-full bg-green-100 flex items-center justify-center mt-0.5">
                <i class="fas fa-check text-green-600 text-xs"></i>
              </div>
              <span class="text-gray-700 text-sm leading-relaxed">Ideal for aggressive growth & fast ROI</span>
            </div>
          </div>
          
          <!-- PayPal Button -->
          <div class="mt-auto">
            <div id="paypal-fast" class="paypal-button-container"></div>
            <p class="text-xs text-gray-500 text-center mt-3 flex items-center justify-center gap-1">
              <i class="fas fa-lock text-gray-400"></i>
              Secure checkout via PayPal
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom CTA Section -->
    <div class="mt-16 text-center">
      <div class="max-w-2xl mx-auto">
        <p class="text-gray-600 mb-6">
          Not sure which package is right for you? Let's discuss your goals and create a custom strategy.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/contact" class="inline-flex items-center justify-center gap-2 px-8 py-4 rounded-full bg-[#f97316] text-white font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200">
            <i class="fas fa-comments"></i>
            Get Free Consultation
          </a>
          <a href="/case-studies" class="inline-flex items-center justify-center gap-2 px-8 py-4 rounded-full bg-[#f8fafc] text-gray-800 font-bold shadow-lg ring-1 ring-gray-200 hover:bg-gray-50 transition">
            <i class="fas fa-chart-line"></i>
            View Success Stories
          </a>
        </div>
      </div>
    </div>
  </div>
</section>

<script is:inline define:vars={{
  PAYPAL_CLIENT_ID: ENV_PAYPAL_CLIENT_ID,
  PLAN_STARTER: ENV_PLAN_STARTER,
  PLAN_GROWTH: ENV_PLAN_GROWTH,
  PLAN_FAST: ENV_PLAN_FAST,
  SUCCESS_URL: ENV_SUCCESS_URL,
  CANCEL_URL: ENV_CANCEL_URL,
  CURRENCY: ENV_CURRENCY
}}>

  function loadPayPalSdk() {
    return new Promise((resolve, reject) => {
      if (typeof window === 'undefined') return resolve(null);
      if (window.paypal) return resolve(window.paypal);
      const existing = document.getElementById('paypal-sdk');
      if (existing) {
        existing.addEventListener('load', () => resolve(window.paypal));
        existing.addEventListener('error', reject);
        return;
      }
      if (!PAYPAL_CLIENT_ID) {
        console.warn('PayPal client ID not configured');
        return resolve(null);
      }
      const script = document.createElement('script');
      script.id = 'paypal-sdk';
      script.src = `https://www.paypal.com/sdk/js?client-id=${encodeURIComponent(PAYPAL_CLIENT_ID)}&components=buttons&vault=true&intent=subscription&currency=${encodeURIComponent(CURRENCY)}`;
      script.async = true;
      script.onload = () => resolve(window.paypal);
      script.onerror = reject;
      document.head.appendChild(script);
    });
  }

  function renderSubscriptionButton(selector, planId) {
    const target = document.querySelector(selector);
    if (!target || !planId) return;
    
    paypal.Buttons({
      style: {
        shape: 'rect',
        color: 'white',
        layout: 'vertical',
        label: 'subscribe',
        height: 48,
        tagline: false
      },
      createSubscription: (data, actions) => {
        return actions.subscription.create({
          plan_id: planId
        });
      },
      onApprove: (data, actions) => {
        const subscriptionId = data.subscriptionID;
        window.location.href = `${SUCCESS_URL}?subscriptionID=${subscriptionId}`;
      },
      onCancel: () => {
        window.location.href = CANCEL_URL;
      },
      onError: (err) => {
        console.error('PayPal error', err);
        target.innerHTML = '<span class="text-sm text-red-600">Payment initialisation failed. Please try again or contact support.</span>';
      }
    }).render(selector);
  }

  (async () => {
    try {
      const paypal = await loadPayPalSdk();
      if (!paypal) {
        const msg = '<span class="text-sm text-gray-600">Subscribe with PayPal is unavailable right now. Please refresh, disable ad blockers, or contact us.</span>';
        const ids = ['#paypal-starter', '#paypal-growth', '#paypal-fast'];
        ids.forEach((sel) => {
          const el = document.querySelector(sel);
          if (el) el.innerHTML = msg;
        });
        return;
      }
      renderSubscriptionButton('#paypal-starter', PLAN_STARTER);
      renderSubscriptionButton('#paypal-growth', PLAN_GROWTH);
      renderSubscriptionButton('#paypal-fast', PLAN_FAST);
    } catch (e) {
      console.error('Failed to load PayPal SDK', e);
      const msg = '<span class="text-sm text-red-600">PayPal error: ' + e.message + '</span>';
      const ids = ['#paypal-starter', '#paypal-growth', '#paypal-fast'];
      ids.forEach((sel) => {
        const el = document.querySelector(sel);
        if (el) el.innerHTML = msg;
      });
    }
  })();
</script>
