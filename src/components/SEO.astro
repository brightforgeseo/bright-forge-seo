---
export interface Props {
  title: string;
  description: string;
  canonical?: string;
  image?: string;
  type?: 'website' | 'article' | 'blog' | 'product' | 'service' | 'profile' | 'company';
  publishDate?: string;
  modifiedDate?: string;
  author?: {
    name: string;
    url?: string;
  };
  organization?: {
    name: string;
    url: string;
    logo: string;
    sameAs?: string[];
  };
  article?: {
    tags?: string[];
    section?: string;
  };
  breadcrumbs?: Array<{
    name: string;
    url: string;
  }>;
  noindex?: boolean;
  nofollow?: boolean;
  // Control which global schemas to include; default off to avoid duplication across pages
  includeOrganization?: boolean;
  includeWebsite?: boolean;
  includeLocalBusiness?: boolean;
  includeGenericFAQ?: boolean;
  // Optional per-page FAQs to build a page-specific FAQPage schema
  faqs?: Array<{
    question: string;
    answer: string;
  }>;
  // Review and AggregateRating schema support
  includeReviews?: boolean;
}

const {
  title,
  description,
  canonical = Astro.url.href,
  image = '/images/logo-bright-forge.png', // Default OG image
  type = 'website',
  publishDate,
  modifiedDate,
  author,
  organization = {
    name: 'Bright Forge SEO',
    url: 'https://brightforgeseo.com',
    logo: 'https://brightforgeseo.com/images/logo.png',
    sameAs: [
      'https://www.facebook.com/brightforgeseo',
      'https://twitter.com/brightforgeseo',
      'https://www.linkedin.com/company/brightforge-seo',
      'https://www.instagram.com/brightforgeseo'
    ]
  },
  article,
  breadcrumbs,
  noindex = false,
  nofollow = false,
  includeOrganization = false,
  includeWebsite = false,
  includeLocalBusiness = false,
  includeGenericFAQ = false,
  faqs,
  includeReviews = false
} = Astro.props;

// Determine final page type (allow inference from URL when not explicitly set)
const pathname = Astro.url.pathname || '';
let resolvedType = type;
if ((Astro.props.type === undefined || Astro.props.type === 'website')) {
  // Infer service pages by common route patterns
  const serviceLike = /seo-services|services|\-seo\-services/i.test(pathname);
  if (serviceLike) {
    resolvedType = 'service';
  }
}

// Generate JSON-LD schema based on resolved page type
let schema;

// Base WebSite schema
const websiteSchema = {
  "@context": "https://schema.org",
  "@type": "WebSite",
  "name": "Bright Forge SEO",
  "url": "https://brightforgeseo.com",
  "potentialAction": {
    "@type": "SearchAction",
    "target": "https://brightforgeseo.com/search?q={search_term_string}",
    "query-input": "required name=search_term_string"
  }
};

// Organization schema
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "name": organization.name,
  "url": organization.url,
  "logo": organization.logo,
  "sameAs": organization.sameAs
};

// Review schema with actual Google review data
const reviewSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": "https://brightforgeseo.com/#localbusiness",
  "name": "Bright Forge SEO",
  "description": "Professional SEO services to boost your online visibility and organic traffic",
  "url": organization.url,
  "telephone": "+63-917-123-4567",
  "priceRange": "$$$",
  "image": organization.logo,
  "address": {
    "@type": "PostalAddress",
    "addressCountry": "PH",
    "addressRegion": "NCR",
    "addressLocality": "Quezon City"
  },
  "aggregateRating": {
    "@type": "AggregateRating",
    "ratingValue": "5.0",
    "bestRating": "5",
    "worstRating": "1",
    "ratingCount": "9",
    "reviewCount": "9"
  },
  "review": [
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Carhein Grace Saquilabon"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "I can't say enough good things about Bright Forge SEO! Their SEO services have been an absolute game-changer for my small business. From the moment I reached out, their team was incredibly responsive and took the time to truly understand my needs and goals.",
      "datePublished": "2024-10-20"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Marie Angela Benida"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Bright Forge SEO is an absolute gem! I've been working with them for the past few months, and my website's visibility has improved drastically. The team is knowledgeable, patient, and always ready to answer my questions (even the silly ones!).",
      "datePublished": "2024-07-15"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Aly Dons"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Bright Forge SEO has been an invaluable partner for our business. Their expertise in SEO helped us climb to the top of search rankings, driving significant traffic to our website. The team is professional, responsive, and always goes above and beyond to deliver results.",
      "datePublished": "2024-06-10"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Rich Devman"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "These guys are trustworthy and good!",
      "datePublished": "2024-03-20"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Erwin Valles"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "I highly recommend Ninja SEO Marketing for their exceptional SEO services. As a business owner, I was struggling to increase my online visibility and attract more customers. Ninja SEO Marketing came to the rescue and provided me with a tailored SEO strategy that exceeded my expectations.",
      "datePublished": "2023-04-12"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Jacob Smailes"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "As a business with a global target audience, we needed an SEO agency that could help us navigate the intricacies of international search optimization. The team delivered exceptional results and helped us expand our reach significantly.",
      "datePublished": "2023-03-17"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Amr Hanafy"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Ninja SEO Marketing is a professional and reliable digital marketing agency that specializes in search engine optimization. Their expertise and dedication have helped numerous businesses improve their online visibility and drive organic traffic.",
      "datePublished": "2023-03-10"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "Ben Wall"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Was a pleasure working with Ben. SEO expert and clearly knows his stuff. Thank you :)",
      "datePublished": "2022-06-23"
    },
    {
      "@type": "Review",
      "author": {
        "@type": "Person",
        "name": "RJ GO"
      },
      "reviewRating": {
        "@type": "Rating",
        "ratingValue": "5",
        "bestRating": "5",
        "worstRating": "1"
      },
      "reviewBody": "Solid experience. My organic traffic went from 1,000 to 64,000 and been growing more. Definitely a must service for all business owners who wants to rock the organic search!",
      "datePublished": "2022-06-20"
    }
  ]
};

// Determine which schema to use based on page type
if (resolvedType === 'article' || resolvedType === 'blog') {
  schema = {
    "@context": "https://schema.org",
    "@type": "Article",
    "headline": title,
    "description": description,
    "image": image.startsWith('http') ? image : `https://brightforgeseo.com${image}`,
    "author": author ? {
      "@type": "Person",
      "name": author.name,
      "url": author.url
    } : undefined,
    "publisher": {
      "@type": "Organization",
      "name": organization.name,
      "logo": {
        "@type": "ImageObject",
        "url": organization.logo
      }
    },
    "datePublished": publishDate,
    "dateModified": modifiedDate || publishDate,
    "mainEntityOfPage": {
      "@type": "WebPage",
      "@id": canonical
    }
  };
  
  // Add article tags if available
  if (article?.tags && article.tags.length > 0) {
    schema.keywords = article.tags.join(', ');
  }
  
  // Add article section if available
  if (article?.section) {
    schema.articleSection = article.section;
  }
} else if (resolvedType === 'service') {
  schema = {
    "@context": "https://schema.org",
    "@type": "Service",
    "name": title,
    "description": description,
    "provider": {
      "@type": "Organization",
      "name": organization.name,
      "url": organization.url,
      "logo": {
        "@type": "ImageObject",
        "url": organization.logo
      },
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+63-969-620-6182",
        "contactType": "customer service",
        "email": "seo@brightforgeseo.com"
      }
    },
    "serviceType": title,
    "url": canonical,
    "areaServed": [
      {
        "@type": "Country",
        "name": "Philippines"
      },
      {
        "@type": "Country",
        "name": "United States"
      },
      {
        "@type": "Country",
        "name": "Australia"
      },
      {
        "@type": "Country",
        "name": "United Kingdom"
      }
    ],
    "category": "SEO Services",
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "SEO Service Packages",
      "itemListElement": [
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Basic SEO Package"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Advanced SEO Package"
          }
        },
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Service",
            "name": "Enterprise SEO Package"
          }
        }
      ]
    },

  };
} else if (resolvedType === 'company' || resolvedType === 'profile') {
  schema = organizationSchema;
} else {
  // Default to WebPage schema
  schema = {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": title,
    "description": description,
    "url": canonical,
    "datePublished": publishDate,
    "dateModified": modifiedDate || publishDate,
    "isPartOf": {
      "@type": "WebSite",
      "name": "Bright Forge SEO",
      "url": "https://brightforgeseo.com"
    },
    "publisher": {
      "@type": "Organization",
      "name": organization.name,
      "logo": {
        "@type": "ImageObject",
        "url": organization.logo
      }
    }
  };
}

// Add breadcrumb schema if breadcrumbs are provided
let breadcrumbSchema;
if (breadcrumbs && breadcrumbs.length > 0) {
  breadcrumbSchema = {
    "@context": "https://schema.org",
    "@type": "BreadcrumbList",
    "itemListElement": breadcrumbs.map((item, index) => ({
      "@type": "ListItem",
      "position": index + 1,
      "name": item.name,
      "item": item.url.startsWith('http') ? item.url : `https://brightforgeseo.com${item.url}`
    }))
  };
}

// Enhanced Local Business schema for Philippines location
const localBusinessSchema = {
  "@context": "https://schema.org",
  "@type": ["LocalBusiness", "SEOAgency", "DigitalMarketingAgency"],
  "name": "Bright Forge SEO",
  "alternateName": "Bright Forge SEO Philippines",
  "image": "https://brightforgeseo.com/images/logo-bright-forge.png",
  "url": "https://brightforgeseo.com",
  "telephone": "+63-969-620-6182",
  "email": "seo@brightforgeseo.com",
  "address": {
    "@type": "PostalAddress",
    "streetAddress": "Kathleen Place 4, Block 16, Lot 37, Armani Street",
    "addressLocality": "Novaliches",
    "addressRegion": "Quezon City",
    "postalCode": "1123",
    "addressCountry": "PH"
  },
  "geo": {
    "@type": "GeoCoordinates",
    "latitude": 14.6760,
    "longitude": 121.0437
  },
  "openingHoursSpecification": [
    {
      "@type": "OpeningHoursSpecification",
      "dayOfWeek": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "opens": "09:00",
      "closes": "18:00"
    }
  ],
  "priceRange": "₱₱₱",
  "currenciesAccepted": "PHP, USD",
  "paymentAccepted": "Cash, Credit Card, Bank Transfer",
  "serviceArea": {
    "@type": "GeoCircle",
    "geoMidpoint": {
      "@type": "GeoCoordinates",
      "latitude": 14.6760,
      "longitude": 121.0437
    },
    "geoRadius": "50000"
  },
  "areaServed": [
    {
      "@type": "Country",
      "name": "Philippines"
    },
    {
      "@type": "Country",
      "name": "United States"
    },
    {
      "@type": "Country",
      "name": "Australia"
    },
    {
      "@type": "Country",
      "name": "United Kingdom"
    }
  ],
  "knowsAbout": [
    "Search Engine Optimization",
    "Technical SEO",
    "Content Marketing",
    "Link Building",
    "Local SEO",
    "E-commerce SEO",
    "SEO Audits",
    "White Label SEO",
    "Digital Marketing",
    "Website Development"
  ],

};

// FAQ Schema for better SERP features
const faqSchema = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  "mainEntity": [
    {
      "@type": "Question",
      "name": "What SEO services does Bright Forge SEO offer?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "We offer comprehensive SEO services including technical SEO, on-page optimization, content SEO, backlink building, local SEO, e-commerce SEO, SEO audits, and white-label SEO solutions."
      }
    },
    {
      "@type": "Question",
      "name": "How long does it take to see SEO results?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "SEO results typically take 3-6 months to become visible, depending on competition, website condition, and the scope of optimization work required."
      }
    },
    {
      "@type": "Question",
      "name": "Do you provide SEO services for international clients?",
      "acceptedAnswer": {
        "@type": "Answer",
        "text": "Yes, we serve clients globally including the Philippines, United States, Australia, and United Kingdom with tailored SEO strategies for each market."
      }
    }
  ]
};
---

<!-- SEO Meta Tags -->
<title>{title}</title>
<meta name="description" content={description} />
<link rel="canonical" href={canonical} />

<!-- Robots Meta -->
<meta name="robots" content={`${noindex ? 'noindex' : 'index'},${nofollow ? 'nofollow' : 'follow'}`} />

<!-- Open Graph / Facebook -->
<meta property="og:type" content={resolvedType === 'article' || resolvedType === 'blog' ? 'article' : 'website'} />
<meta property="og:url" content={canonical} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content="https://brightforgeseo.com/images/og-hero-wife-letterbox-v1.jpg?v=4" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/jpeg" />
<meta property="og:site_name" content="Bright Forge SEO" />
<!-- Facebook App ID - Add when available -->
{publishDate && <meta property="article:published_time" content={publishDate} />}
{modifiedDate && <meta property="article:modified_time" content={modifiedDate} />}
{article?.section && <meta property="article:section" content={article.section} />}
{article?.tags && article.tags.map(tag => (
  <meta property="article:tag" content={tag} />
))}

<!-- Twitter -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonical} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content="https://brightforgeseo.com/images/og-hero-wife-letterbox-v1.jpg?v=4" />

<!-- Main Page Schema -->
<script type="application/ld+json" set:html={JSON.stringify(schema)} />

<!-- Optional global schemas, controlled via props to prevent duplication sitewide -->
{includeWebsite && (
  <script type="application/ld+json" set:html={JSON.stringify(websiteSchema)} />
)}
{includeOrganization && !schema?.provider && (
  <script type="application/ld+json" set:html={JSON.stringify(organizationSchema)} />
)}
{includeLocalBusiness && (
  <script type="application/ld+json" set:html={JSON.stringify(localBusinessSchema)} />
)}

<!-- Per-page FAQ schema (preferred when provided) -->
{faqs && faqs.length > 0 && (
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": faqs.map(f => ({
      "@type": "Question",
      "name": f.question,
      "acceptedAnswer": { "@type": "Answer", "text": f.answer }
    }))
  })} />
)}

<!-- Optional generic FAQ (off by default and only when no per-page FAQs); avoid on case studies -->
{(!faqs || faqs.length === 0) && includeGenericFAQ && !Astro.url.pathname.includes('/case-studies/') && (
  <script type="application/ld+json" set:html={JSON.stringify(faqSchema)} />
)}

<!-- Breadcrumb Schema (if available) -->
{breadcrumbs && breadcrumbs.length > 0 && (
  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbSchema)} />
)}

<!-- Review and AggregateRating Schema (sitewide when enabled) -->
{includeReviews && (
  <script type="application/ld+json" set:html={JSON.stringify(reviewSchema)} />
)}
