---
// MainLayout.astro
import SEO from '../components/SEO.astro';

// Standard Astro CSS imports - these should automatically generate link tags
import '../styles/global.css';
import '../styles/case-study-fix.css';
import '../styles/bundled.css';
// Removed breadcrumbs.css - now using inline styles to prevent conflicts
import '../styles/force-black-breadcrumbs.css'; // Global CSS override for black breadcrumb text
// REMOVED critical.css and red-theme.css - they were overriding hero gradients

interface Props {
  title: string;
  description?: string;
  canonical?: string;
  image?: string;
  type?: 'website' | 'article' | 'blog' | 'product' | 'service' | 'profile' | 'company';
  publishDate?: string;
  modifiedDate?: string;
  author?: {
    name: string;
    url?: string;
  };
  article?: {
    tags?: string[];
    section?: string;
  };
  breadcrumbs?: Array<{
    name: string;
    url: string;
  }>;
  noindex?: boolean;
  nofollow?: boolean;
  faqs?: Array<{
    question: string;
    answer: string;
  }>;
}

const { 
  title, 
  description = "Bright Forge SEO Philippines - Your partner for SEO and digital marketing",
  canonical = Astro.url.href,
  image,
  type = 'website',
  publishDate,
  modifiedDate,
  author,
  article,
  breadcrumbs,
  noindex = false,
  nofollow = false,
  faqs
} = Astro.props;

// With trailingSlash set to 'always', canonical can simply use current URL
const finalCanonical = canonical;
const isHome = Astro.url.pathname === '/';

---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <!-- Mobile-specific optimization -->
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <!-- Force consistent light color scheme across browsers -->
    <meta name="color-scheme" content="light" />
    <meta name="supported-color-schemes" content="light" />
    <meta name="google-site-verification" content="ChxTytE2xXPqUiIN7QDHvdQD0Z3JKf6vpa1DcVKTRR4" />
    <!-- Title tag handled by SEO component to prevent duplicates -->
    
    <!-- SEO Component with Schema, Canonical URLs, and Meta Tags -->
    <SEO
      title={title}
      description={description}
      canonical={finalCanonical}
      image={image}
      type={type}
      publishDate={publishDate}
      modifiedDate={modifiedDate}
      author={author}
      article={article}
      breadcrumbs={breadcrumbs}
      noindex={noindex}
      nofollow={nofollow}
      includeWebsite={isHome}
      includeOrganization={isHome}
      includeLocalBusiness={false}
      includeGenericFAQ={false}
      faqs={faqs}
      includeReviews={true}
    />
    
    <slot name="head" />
    
    <!-- Early hints for critical resources -->
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Critical CSS inline for faster FCP -->
    <style>
      /* Critical inline CSS for instant render */
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        margin: 0;
      }
      img { max-width: 100%; height: auto; }
      /* Prevent FOIT (Flash of Invisible Text) */
      @font-face {
        font-family: 'DM Sans Fallback';
        src: local('Arial');
        size-adjust: 100%;
        ascent-override: 90%;
        descent-override: 20%;
      }
      /* Inline critical icon styles to avoid FontAwesome blocking */
      .fas, .far, .fab { display: inline-block; width: 1em; height: 1em; }
    </style>

    <!-- Load fonts asynchronously to not block rendering -->
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;700&display=swap" rel="stylesheet"></noscript>

    <!-- Preload hero image with highest priority -->
    <link rel="preload" as="image" href="/images/Hero-SEO-Agency-In-The-Philippines.webp" fetchpriority="high" imagesrcset="/images/Hero-SEO-Agency-In-The-Philippines.webp 1x" imagesizes="100vw">

    <!-- Defer non-critical JavaScript -->
    <script defer>
      // Disable hover effects on mobile for better performance
      if ('ontouchstart' in window) {
        document.documentElement.classList.add('touch-device');
      }
    </script>

    <!-- Prevent layout shifts -->
    <style>
      /* Prevent CLS (Cumulative Layout Shift) */
      img:not([width]):not([height]) {
        aspect-ratio: attr(width) / attr(height);
      }

      /* Disable hover effects on touch devices */
      .touch-device *:hover {
        transition: none !important;
      }

      /* Optimize mobile fonts */
      @media (max-width: 768px) {
        * {
          text-size-adjust: 100%;
          -webkit-text-size-adjust: 100%;
        }
      }
    </style>
    
    <!-- Updated Favicons -->
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favcon/bright-forge-favcon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favcon/bright-forge-favcon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/favcon/bright-forge-favcon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#f97316">
    <meta name="msapplication-TileColor" content="#f97316">
    <meta name="msapplication-TileImage" content="/images/favcon/bright-forge-favcon.png">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="format-detection" content="telephone=no">
    <meta name="geo.region" content="PH-00">
    <meta name="geo.placename" content="Quezon City, Philippines">
    <meta name="geo.position" content="14.6760;121.0437">
    <meta name="ICBM" content="14.6760, 121.0437">
    <meta name="language" content="en-PH">
    <meta name="distribution" content="global">
    <meta name="rating" content="general">
    
    <!-- Business Information -->
    <meta name="business:contact_data:street_address" content="Kathleen Place 4, Block 16, Lot 37, Armani Street">
    <meta name="business:contact_data:locality" content="Novaliches">
    <meta name="business:contact_data:region" content="Quezon City">
    <meta name="business:contact_data:postal_code" content="1123">
    <meta name="business:contact_data:country_name" content="Philippines">
    <meta name="business:contact_data:email" content="seo@brightforge.com.ph">
    <meta name="business:contact_data:phone_number" content="+63-969-620-6182">
    
    <!-- CSS is already imported above and will be processed by Astro -->
  </head>
  <body class="font-dm-sans text-brand-dark bg-[#f8fafc] min-h-screen flex flex-col">
    <slot name="header" />
    <main class="flex-1">
      <slot />
    </main>
    <slot name="footer" />
    
    <!-- Load non-critical resources after page load -->
    <script>
      // Load FontAwesome after first paint to avoid render blocking
      if ('requestIdleCallback' in window) {
        requestIdleCallback(function() {
          var fa = document.createElement('link');
          fa.rel = 'stylesheet';
          fa.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';
          document.head.appendChild(fa);
        });
      } else {
        window.addEventListener('load', function() {
          var fa = document.createElement('link');
          fa.rel = 'stylesheet';
          fa.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css';
          document.head.appendChild(fa);
        });
      }

      // Load analytics after page load
      window.addEventListener('load', function() {
        setTimeout(function() {
          var sa = document.createElement('script');
          sa.async = true;
          sa.src = 'https://scripts.simpleanalyticscdn.com/latest.js';
          document.head.appendChild(sa);
        }, 2000);
      });
    </script>
  </body>
<style is:global>
  /* Final fix: Force html background to dark to hide any rendering gap */
  html {
    background-color: #1a1a1a; /* Footer dark color */
  }

  body {
    background-color: #f8fafc !important; /* Site grey */
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    margin: 0;
    padding: 0;
  }

  main {
    flex-grow: 1;
  }
</style>
</html>
